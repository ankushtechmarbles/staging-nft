"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8692],{4646:(t,e,i)=>{function n(t){return"string"==typeof t?Number.parseInt(t,"0x"===t.trim().substring(0,2)?16:10):"bigint"==typeof t?Number(t):t}i.d(e,{n:()=>n})},38692:(t,e,i)=>{i.d(e,{PaperWalletConnector:()=>g});var n=i(16074),s=i(42009),a=i(74018),o=i(19485),r=i(20722),h=i(27021),c=i(4646),d=(i(54146),new WeakMap);class g extends h.C{constructor(t){super(),(0,s._)(this,"id",r.w.paper),(0,s._)(this,"name","Paper Wallet"),(0,s._)(this,"ready",!0),(0,s._)(this,"user",null),(0,n._)(this,d,{writable:!0,value:void 0}),(0,s._)(this,"onAccountsChanged",(async t=>{0===t.length?await this.onDisconnect():this.emit("change",{account:o.getAddress(t[0])})})),(0,s._)(this,"onChainChanged",(t=>{const e=(0,c.n)(t),i=-1===this.options.chains.findIndex((t=>t.chainId===e));this.emit("change",{chain:{id:e,unsupported:i}})})),(0,s._)(this,"onDisconnect",(async()=>{this.emit("disconnect")})),this.options=t}getPaperSDK(){return this.paper||(this.paper=new Promise((async(t,e)=>{const n=this.options.advancedOptions?.recoveryShareManagement;try{const{PaperEmbeddedWalletSdk:e}=await Promise.resolve().then(i.bind(i,74018)),s={AWS_MANAGED:a.pw.AWS_MANAGED,USER_MANAGED:a.pw.USER_MANAGED};t(new e({advancedOptions:{recoveryShareManagement:n?s[n]:void 0},clientId:this.options.clientId,chain:"Ethereum",styles:this.options.styles,onAuthSuccess:this.options.onAuthSuccess}))}catch(t){e(t)}}))),this.paper}async connect(t){const e=await this.getPaperSDK();if(!e)throw new Error("Paper SDK not initialized");const i=await e.getUser();switch(i.status){case a.J0.LOGGED_OUT:{let i;if(t?.googleLogin){const n=t.googleLogin;i=await e.auth.loginWithGoogle("object"==typeof n?n:void 0)}else i=t?.email&&t?.otp?await e.auth.verifyPaperEmailLoginOtp({email:t.email,otp:t.otp,recoveryCode:t.recoveryCode}):t?.email?await e.auth.loginWithPaperEmailOtp({email:t.email}):await e.auth.loginWithPaperModal();this.user=i.user;break}case a.J0.LOGGED_IN_WALLET_INITIALIZED:"object"==typeof t?.googleLogin&&t.googleLogin.closeOpenedWindow&&t.googleLogin.openedWindow&&t.googleLogin.closeOpenedWindow(t.googleLogin.openedWindow),this.user=i}if(!this.user)throw new Error("Error connecting User");return t?.chainId&&this.switchChain(t.chainId),this.setupListeners(),this.getAddress()}async disconnect(){const t=await this.paper;await(t?.auth.logout()),(0,n.a)(this,d,void 0),this.user=null}async getAddress(){return(await this.getSigner()).getAddress()}async isConnected(){try{return!!await this.getAddress()}catch(t){return!1}}async getProvider(){const t=await this.getSigner();if(!t.provider)throw new Error("Provider not found");return t.provider}async getSigner(){if((0,n.b)(this,d))return(0,n.b)(this,d);if(!this.user){const t=await this.getPaperSDK(),e=await t.getUser();if(e.status===a.J0.LOGGED_IN_WALLET_INITIALIZED)this.user=e}const t=await(this.user?.wallet.getEthersJsSigner({rpcEndpoint:this.options.chain.rpc[0]||""}));if(!t)throw new Error("Signer not found");return(0,n.a)(this,d,t),t}async isAuthorized(){return!1}async switchChain(t){const e=this.options.chains.find((e=>e.chainId===t));if(!e)throw new Error("Chain not configured");await(this.user?.wallet.setChain({chain:"Ethereum"})),(0,n.a)(this,d,await(this.user?.wallet.getEthersJsSigner({rpcEndpoint:e.rpc[0]||""}))),this.emit("change",{chain:{id:t,unsupported:!1}})}async setupListeners(){const t=await this.getProvider();t.on&&(t.on("accountsChanged",this.onAccountsChanged),t.on("chainChanged",this.onChainChanged),t.on("disconnect",this.onDisconnect))}updateChains(t){this.options.chains=t}async getEmail(){if(await this.getProvider(),!this.user)throw new Error("No user found, Paper Wallet is not connected");return this.user.authDetails.email}}}}]);
//# sourceMappingURL=8692.js.map