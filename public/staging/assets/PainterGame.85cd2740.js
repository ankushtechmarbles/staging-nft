import{A as C,u,r as s,o as k,m as B,a as p,k as E}from"./index.c3f8b9a9.js";const D=e=>{e.current.undoing||(e.current.saveSnapshot(),e.current.undoing=!0,e.current.snapshotIndex-=1,e.current.maxRedoIndex=e.current.snapshotIndex),e.current.canUndo()&&(e.current.applySnapshot(e.current.snapshots[e.current.snapshotIndex-1]),e.current.snapshotIndex-=1),e.current.refreshDoButtons(),e.current.needsRedraw=!0},y=e=>{e.current.canRedo()&&(e.current.applySnapshot(e.current.snapshots[e.current.snapshotIndex+1]),e.current.snapshotIndex+=1),e.current.refreshDoButtons(),e.current.needsRedraw=!0},A=e=>{e.current.brushColorHSVA=[1,1,1,1]},z=e=>{const{setPaintedImage:x,addToBackgrounds:g,availableBackgrounds:S}=C(),{paintBrush:r,paintOptions:l,gameStart:h,gameFinished:c,showRemix:P}=u(),d=s.exports.useRef(),a=s.exports.useRef(),t=s.exports.useRef(),[m,T]=s.exports.useState(!0),[i,v]=s.exports.useState(null),b=k();B("(min-width: 1000px)");const I=(n,o)=>{b({title:"",description:n,status:o,duration:9e3,isClosable:!0})};async function R(){let n;await html2canvas(e.screenshotRefs.current).then(w=>{n=w});let o=document.getElementById("link");o.setAttribute("download","example.png"),o.setAttribute("href",n.toDataURL()),o.click()}s.exports.useEffect(()=>{if(!t.current&&(a.current=WrappedGL.create(d.current,{preserveDrawingBuffer:!1}),a.current!==null&&a.current!==void 0&&a.current.hasFloatTextureSupport())){const n=new Paint(d.current,a.current,m,v,[...r.color],r.brushSize,r.specular_scale,r.diffuse_scale);t.current=n,u.setState({useUndo:()=>D(t),useRedo:()=>y(t),useEraser:()=>A(t)})}},[h]),s.exports.useEffect(()=>{t.current&&(t.current.brushColorHSVA=[...r.color],t.current.brushScale=r.brushSize)},[r]),s.exports.useEffect(()=>{c&&(t.current.brush.bristleCount=0,u.setState({paintingImage:t.current.save()}))},[c]),s.exports.useEffect(()=>{i&&(R(),x(i),g({title:`Custom Background #${S.length}`,image:i,isCustom:!0}),I("Custom canvas saved to backgrounds","success"))},[i]);const f=()=>{!h&&!c&&u.setState({gameStart:!0}),l.selected||u.setState({paintOptions:{...l,selected:{title:"Blank Canvas",blankCanvas:!0}}})};return p(E,{children:p("canvas",{onTouchStart:()=>{f()},onMouseDown:()=>{f()},style:{zIndex:"-1",width:"100%"},pointerEvents:c?"none":"initial",ref:d,id:"canvas"})})};export{z as default};
